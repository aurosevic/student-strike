---
import Base from "@layouts/Base.astro";
import { collection, file, langs } from "@scripts/i18n";
import { getImage } from "astro:assets";

import { SITE_DESCRIPTION } from "../../consts";
import slavija from "@assets/images/slavija.jpg";
import Live from "@components/Live.astro";
import RecentPosts from "@components/RecentPosts.astro";

export async function getStaticPaths() {
  return langs.map((lang) => ({ params: { lang } }));
}

const { lang } = Astro.params;
const { Content: Pocetna } = await file("pocetna", lang);
const { Content: Zahtevi } = await file("zahtevi", lang);
const { frontmatter } = await file("ostalo", lang);
const live = (await collection("vesti", lang)).find((vest) => vest.data.live);
const optimizedSlavija = await getImage({ src: slavija, format: "avif" });

const newsData = await collection("vesti", lang);
const news = newsData.map((x) => ({
  title: x.data.title,
  subtitle: x.body as string,
  thumbnail: x.data.heroImage.src,
  link: `/${lang}/vesti/${x.id}/`,
  date: x.data.pubDate,
}));

const akcijeData = await collection("akcije", lang);
const akcije = akcijeData.map((x) => ({
  title: x.data.title,
  subtitle: x.body as string,
  thumbnail: x.data.heroImage.src,
  link: `/${lang}/akcije/${x.id}/`,
  date: x.data.pubDate,
}));
---

<Base
  {lang}
  title={frontmatter.naslov}
  description={SITE_DESCRIPTION}
  image={slavija.src}
>
  <div
    slot="above"
    class="title"
    style={`background-image: url(${optimizedSlavija.src});`}
  >
    {
      typeof live !== "undefined" && (
        <Live href={`/${lang}/vesti/${live.id}`}>{live.data.title}</Live>
      )
    }

    <h1>{frontmatter.naslov}</h1>
  </div>

  <section>
    <Pocetna />
  </section>

  <section>
    <Zahtevi />
  </section>

  <section class="gap">
    <RecentPosts
      title={frontmatter.najnovije_vesti}
      subtitle={frontmatter.vesti_podnaslov}
      posts={news}
      numPosts={3}
      key="recentNews"
    />
    <a href=`/${lang}/vesti` class="button primary end">{frontmatter.dugme_vesti}</a>
  </section>

  <div class="dark-post">
    <section class="gap">
      <RecentPosts
        title={frontmatter.najnovije_akcije}
        subtitle={frontmatter.najnovije_akcije_podnaslov}
        posts={akcije}
        numPosts={3}
        key="recentArchive"
      />
      <a href=`/${lang}/akcije` class="button primary end">{frontmatter.dugme_akcije}</a>
    </section>
  </div>
</Base>

<style>
  .title {
    position: relative;
    background-size: cover;
    background-position: center;
    height: 30rem;

    display: flex;
    align-items: center;
  }

  .title::before {
    content: "";
    position: absolute;
    background-color: rgba(0, 0, 0, 0.4);
    inset: 0;
    z-index: 0;
  }

  .title h1 {
    margin-inline: auto;
    padding-inline: 2rem;
    color: white;
    z-index: 1;
    font-size: 5rem;
    text-align: center;
  }

  @media (max-width: 720px) {
    .title h1 {
      padding-inline: 2vw;
      font-size: 13vw;
    }
  }

  .title .live {
    position: absolute;
    top: 2rem;
    left: 2rem;
  }

  a.button {
      margin-top: 2rem;
  }

  .gap {
    display: flex;
    flex-direction: column;
    align-items: start;
  }

  .end {
      align-self: end;
  }
</style>
